<launch>

  <arg name="multimap_file" default="$(find utexas_gdc)/maps/simulation/multimap/test.yaml" />
  <arg name="robot_configuration" default="$(find segbot_bringup)/launch/includes/auxiliary.segbot_hokuyo.launch.xml" /> 

  <!-- launch the multi map server for the simulated world -->                                                                 
  <node name="multi_level_map_server" pkg="multi_level_map_server" type="multi_level_map_server">                        
    <rosparam command="load" file="$(arg multimap_file)" />               
  </node>

  <!-- also launch the level multiplexer and the level selector -->
  <node name="level_mux" pkg="multi_level_map_utils" type="level_mux" />                                                 
  <node name="level_selector" pkg="multi_level_map_utils" type="level_selector" />     

  <!-- launch the interruptable action server -->
  <node name="move_base_interruptable" pkg="segbot_apps" type="move_base_interruptable_server" />

  <!-- start the simulation and the robot -->
  <include file="$(find utexas_gdc)/launch/simulation_3ne.launch" />                                               
  <include file="$(find segbot_gazebo)/launch/segbot_mobile_base.launch">                                                
    <arg name="configuration_file" value="$(arg robot_configuration)" />                                                 
    <arg name="y" value="8.0" />
    <arg name="map_frame" value="level_mux/map" /> 
    <arg name="map_service" value="level_mux/static_map" />                                                                       
    <arg name="map_topic" value="level_mux/map" />                                                                       
    <arg name="launch_localization" value="true" />                                                                    
    <arg name="use_fake_localization" value="true" />                                                                    
    <arg name="move_base_server" value="move_base_interruptable" />
    <arg name="launch_move_base" value="true" />                                                                       
    <arg name="use_full_gazebo_model" value="false" />
  </include>                                                                                                             

  <!-- Finally, launch the segbot_logical_navigator to do low-level logical navigation. -->
  <!-- TODO should not have to supply default parameters unless necessary -->
  <node name="segbot_logical_navigator" pkg="segbot_logical_translator" type="segbot_logical_navigator">
    <param name="data_directory" value="$(find utexas_gdc)/maps/simulation/3ne" />
    <param name="map_file" value="$(find utexas_gdc)/maps/simulation/3ne/3ne.yaml" />
    <remap from="move_base" to="move_base_interruptable" />
  </node>

  <!-- launch vizualization -->                                                                                          
  <include file="$(find segbot_navigation)/launch/rviz.launch">                                                          
    <arg name="config" value="nav_eband" />                                                                              
  </include>  

</launch>
